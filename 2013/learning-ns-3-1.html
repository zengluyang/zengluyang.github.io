<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width" />

	<title>ns-3 学习记录-1</title>
	<meta name="author" content="zly">
		
	<link href="/assets/the-program/stylesheets/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/the-program/stylesheets/style.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css" type="text/css" rel="stylesheet" media="all">
 
	<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
</head>
<body>

<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
		
			<div class="unit-inner unit-head-inner">
				<nav class="nav-global">
					<ul>
						<li><a class="brand" href="/">home</a></li>
						
						  


  <li><a href="/archive">Archive</a></li>


						
						  


  <li><a href="/tags">Tags</a></li>


						
						  


  <li><a href="/categories">Categories</a></li>


						
						  


  <li><a href="/pages">Pages</a></li>


						
						  


  <li><a href="/about">About Me</a></li>


						
					</ul>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
						<div class="unit-article layout-post unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">ns-3 学习记录-1</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
					<h1><a style="display: block;" name="ns-3-学习记录-1" href="#ns-3-学习记录-1"></a>ns-3 学习记录-1</h1>

<h2><a style="display: block;" name="关于ns-3" href="#关于ns-3"></a>关于ns-3</h2>

<h3>简介</h3>

<p>ns-3是一个离散事件模拟器，旨在满足学术研究和教学的需求。</p>

<p>ns-3架构：</p>

<p><img src="http://www.nsnam.org/docs/release/3.18/manual/singlehtml/_images/software-organization.png" alt="ns-3架构" />
</p>

<h3>ns-3与ns-2的区别</h3>

<ul>
<li>ns-3现在由积极的开发者维护，而NS-2已经有近10年没有重大的功能性更新</li>
<li>ns-3并不是ns-2的扩展，而是一个全新的模拟器</li>
<li>ns-3提供更多有用的功能，例如：实现代码允许环境（mplementation code execution environment），允许用户在模拟器中允许真正的实现代码</li>
<li>ns-3提供更加底层的抽象，从而允许其更好得构建仿真系统。</li>
<li>ns-3提供更加深入，在当下十分热门的Module（包括LTE和WiFi Module）</li>
<li>ns-3的模拟器脚本可以通过C++或者Python语言编写，而ns-2的脚本语言选择有Otcl</li>
</ul>

<h2><a style="display: block;" name="ns-3的学习资源" href="#ns-3的学习资源"></a>ns-3的学习资源</h2>

<ul>
<li><a href="http://www.nsnam.org/documentation/">官网</a>：

<ul>
<li>ns-3 manul</li>
<li>ns-3 tutorial</li>
<li>ns-3-model library</li>
<li><a href="http://www.nsnam.org/support/mailing-list/">ns-3 mailing list</a></li>
</ul></li>
<li>C++ 语言:<a href="http://www.cplusplus.com/doc/tutorial/">http://www.cplusplus.com/doc/tutorial/</a></li>
<li>Socket编程：<a href="http://book.douban.com/subject/1788421/">APUE</a> Ch.16 Network IPC: Sokcets</li>
<li>Linux 使用：<a href="http://linux.vbird.org/linux_basic/">鸟哥的Linux私房菜-基础篇</a></li>
</ul>

<h2><a style="display: block;" name="ns-3-安装" href="#ns-3-安装"></a>ns-3 安装</h2>

<h3>ns-3 运行环境</h3>

<ul>
<li>Linux x86 及 x86_64</li>
<li>FreeBSD x86 及 x86_64</li>
<li>Mac OS X PowerPC 及 x86</li>
</ul>

<p>注意到虽然ns-3 能够在 Windows上的Cygwin上运行，但现在已经不被官方所支持。
推荐选择Linux Ubuntu发行版作为ns-3的允许环境，可以考虑安装双系统或者在虚拟机内安装Ubuntu。
我采用了Vmare + Ubuntu 12.04 LTS 作为运行环境。</p>

<h3>安装依赖程序</h3>

<p>在Ubuntu终端（Ctrl+ALt+T）中运行：</p>

<pre><code>sudo apt-get install gcc g++ python python-dev
sudo apt-get install mercurial
sudo apt-get install bzr
sudo apt-get install gdb valgrind
</code></pre>

<p>以下为可选组件，但是最好都装上：</p>

<pre><code>sudo apt-get install gsl-bin libgsl0-dev libgsl0ldbl
sudo apt-get install flex bison libfl-dev
sudo apt-get install tcpdump
sudo apt-get install sqlite sqlite3 libsqlite3-dev
sudo apt-get install libxml2 libxml2-dev
sudo apt-get install libgtk2.0-0 libgtk2.0-dev
sudo apt-get install doxygen graphviz imagemagick
sudo apt-get install texlive texlive-extra-utils texlive-latex-extra
sudo apt-get install python-sphinx dia
sudo apt-get install python-pygraphviz python-kiwi python-pygoocanvas libgoocanvas-dev
sudo apt-get install libboost-signals-dev libboost-filesystem-dev
sudo apt-get install openmpi-bin openmpi-common openmpi-doc libopenmpi-dev
</code></pre>

<h3>使用<code>bake.py</code>检查ns-3的依赖项</h3>

<p>使用Mercurial下载<code>Bake</code>
    hg clone <a href="http://code.nsnam.org/bake">http://code.nsnam.org/bake</a>
将<code>Bake</code>添加环境变量
    export BAKE_HOME=<code>pwd</code>/bake
    export PATH=$PATH:$BAKE_HOME
    export PYTHONPATH=$PYTHONPATH:$BAKE_HOME
查找需要安装的程序
    bake.py check
会得到类似下面的输出：</p>

<pre><code>&gt; Python - OK
&gt; GNU C++ compiler - OK
&gt; Mercurial - OK
&gt; CVS - OK
&gt; GIT - OK
&gt; Bazaar - OK
&gt; Tar tool - OK
&gt; Unzip tool - OK
&gt; Unrar tool - OK
&gt; 7z  data compression utility - OK
&gt; XZ data compression utility - OK
&gt; Make - OK
&gt; cMake - OK
&gt; patch tool - OK
&gt; autoreconf tool - OK
&gt; Path searched for tools: /usr/lib64/qt-3.3/bin
/usr/lib64/ccache /usr/local/bin  /usr/bin/bin/usr/local/sbin /usr/sbin
/sbin /user/dcamara/home/scripts/user/dcamara/home/INRIA/Programs/bin 
/user/dcamara/home/INRIA/repos/llvm/build/Debug+Asserts/bin
</code></pre>

<p>如果有未安装的程序，使用<code>sudo apt-get install</code>安装，知道所有检查选项都显示<code>OK</code></p>

<h3>下载 ns-3的源文件</h3>

<p>在终端运行：</p>

<pre><code>wget http://www.nsnam.org/release/ns-allinone-3.18.tar.bz2
tar xjf ns-allinone-3.18.tar.bz2
</code></pre>

<p>ns-3的当前版本可在<a href="http://www.nsnam.org/releases/">http://www.nsnam.org/releases/</a>查看
    cd ns-allinone-3.18/
    ls
可看到类似的目录结构：</p>

<pre><code>bake      constants.py   netanim-3.103  pybindgen-0.16.0.831  util.py
build.py  constants.pyc  ns-3.18        README                util.pyc
</code></pre>

<h3>使用<code>Waf</code>编译ns-3</h3>

<p>进入<code>ns-3.18/</code>文件夹</p>

<pre><code>cd ns-3.18/
</code></pre>

<p>在终端运行：</p>

<pre><code>./waf clean
./waf -d optimized --enable-examples --enable-tests configure
./waf
</code></pre>

<p>编译会持续较长时间
当看到类似下面的消息说明编译成功：</p>

<pre><code>Waf: Entering directory `/home/zly/ns-allinone-3.18/ns-3.18/build'
Waf: Leaving directory `/home/zly/ns-allinone-3.18/ns-3.18/build'
'build' finished successfully 
</code></pre>

<h3>测试 ns-3</h3>

<p>进入到ns-3.18目录，允许</p>

<pre><code>./test.py -c core
</code></pre>

<p>当看到类似下面的消息，说明通过了所有测试用例，ns-3安装成功</p>

<pre><code>159 of 162 tests passed (159 passed, 3 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</code></pre>

<h2><a style="display: block;" name="运行第一个仿真脚本" href="#运行第一个仿真脚本"></a>运行第一个仿真脚本</h2>

<h3>NS-3里的关键概念</h3>

<ul>
<li>节点：

<ul>
<li>ns-3中基本计算设备被抽象为节点。节点由C++中的<code>Node</code>类来描述。<code>Node</code>类提供了用于管理仿真器中网络组件表示的各种方法</li>
</ul></li>
<li>应用程序：

<ul>
<li>在ns-3中，需要被仿真的用户程序被抽象为应用。应用在C++中用Application类来描述。</li>
</ul></li>
<li>信道：

<ul>
<li>在ns-3的模拟环境中，你可以把节点连接到代表数据交换信道的对象上。在这里，基本的通信子网这一抽象概念被称为信道，在C++中用<code>Channel</code>类来描述</li>
</ul></li>
<li>网络设备：

<ul>
<li>在ns-3中，网络设备这一抽象概念相当于硬件设备和软件驱动的总和。NS3仿真环境中，网络设备相当于安装在节点上，使得节点通过信道和其他节点通信。像真实的计算机一样，一个节点可以通过多个网络设备同时连接到多条信道上。</li>
<li>网络设备由C++中的<code>NetDevice</code>类来描述。NetDevice类提供了管理连接其他节点和信道对象的各种方法，并且允许开发者以面向对象的方法来自定义。</li>
</ul></li>
</ul>

<h3><code>myfirst.cc</code></h3>

<p>在<code>ns-3.18/scratch</code>目录下建立<code>myfirst.cc</code>文件，并键入下面的C++代码：</p>

<pre><code>#include &quot;ns3/core-module.h&quot;
#include &quot;ns3/network-module.h&quot;
#include &quot;ns3/internet-module.h&quot;
#include &quot;ns3/point-to-point-module.h&quot;
#include &quot;ns3/applications-module.h&quot;

using namespace ns3;

NS_LOG_COMPONENT_DEFINE (&quot;FirstScriptExample&quot;);

int
main (int argc, char *argv[])
{
  Time::SetResolution (Time::NS);
  LogComponentEnable (&quot;UdpEchoClientApplication&quot;, LOG_LEVEL_INFO);
  LogComponentEnable (&quot;UdpEchoServerApplication&quot;, LOG_LEVEL_INFO);


  NS_LOG_INFO (&quot;Creating Topology&quot;);

  NodeContainer nodes;
  nodes.Create (2);

  PointToPointHelper pointToPoint;
  pointToPoint.SetDeviceAttribute (&quot;DataRate&quot;, StringValue (&quot;5Mbps&quot;));
  pointToPoint.SetChannelAttribute (&quot;Delay&quot;, StringValue (&quot;2ms&quot;));

  NetDeviceContainer devices;
  devices = pointToPoint.Install (nodes);

  InternetStackHelper stack;
  stack.Install (nodes);

  Ipv4AddressHelper address;
  address.SetBase (&quot;10.1.1.0&quot;, &quot;255.255.255.0&quot;);

  Ipv4InterfaceContainer interfaces = address.Assign (devices);

  UdpEchoServerHelper echoServer (9);

  ApplicationContainer serverApps = echoServer.Install (nodes.Get (1));
  serverApps.Start (Seconds (1.0));
  serverApps.Stop (Seconds (10.0));

  UdpEchoClientHelper echoClient (interfaces.GetAddress (1), 9);
  echoClient.SetAttribute (&quot;MaxPackets&quot;, UintegerValue (2));
  echoClient.SetAttribute (&quot;Interval&quot;, TimeValue (Seconds (0.001)));
  echoClient.SetAttribute (&quot;PacketSize&quot;, UintegerValue (1024));

  ApplicationContainer clientApps = echoClient.Install (nodes.Get (0));
  clientApps.Start (Seconds (2.0));
  clientApps.Stop (Seconds (10.0));

  Simulator::Run ();
  Simulator::Destroy ();
  return 0;
}
</code></pre>

<p>回到<code>ns-3.18</code>目录
先编译新增加的脚本：</p>

<pre><code>./waf
</code></pre>

<p>运行<code>myfisrt.cc</code>脚本：</p>

<pre><code>./waf --run scratch/myfirst
</code></pre>

<p>得到下面的输出：</p>

<pre><code>At time 2s client sent 1024 bytes to 10.1.1.2 port 9
At time 2.001s client sent 1024 bytes to 10.1.1.2 port 9
At time 2.00369s server received 1024 bytes from 10.1.1.1 port 49153
At time 2.00369s server sent 1024 bytes to 10.1.1.1 port 49153
At time 2.00537s server received 1024 bytes from 10.1.1.1 port 49153
At time 2.00537s server sent 1024 bytes to 10.1.1.1 port 49153
At time 2.00737s client received 1024 bytes from 10.1.1.2 port 9
At time 2.00906s client received 1024 bytes from 10.1.1.2 port 9
</code></pre>

					<div class="meta">
						<p class="date-publish">
							Published: 
							<date class="date-pub" title="" datetime="" pubdate>
							<span class="month"><abbr></abbr></span>
							<span class="day"></span>
							<span class="year"></span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">category: </li>
							
							  <li>
  <a href="/categories/#Blog-ref">Blog <span>2</span></a>
</li>
							
						</ul>
						<ul class="list-tag list-linear">
							
							  <li>
  <a href="/tags/#ns-3-ref">ns-3 <span>1</span></a>
</li>
							
						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
				<div class="misc-content">
					<div class="social">
						<ul class="list-linear">
							<li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="" data-lang="en">Tweet</a></div></li>
							<li><div class="twitter-follow"><a href="https://twitter.com/" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
						</ul>
					</div>
					<div class="comment">
						
<div id="disqus_thread"></div>
<script>
    var disqus_developer = 1;
    var disqus_shortname = 'imzlyme'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

					</div>
				</div><!-- misc-content -->
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
<!-- 							{% if page.previous %}
							<li class="prev"><a class="internal" rel="prev"  href="" title="View ">&laquo; </a></li>
							{% endif %}
							{% if page.previous and page.next %}
							<li class="pipe"> | </li>
							{% endif %}
							{% if page.next %}
							<li class="next"><a class="internal" rel="next"  href="" title="View "> &raquo;</a></li>
							{% endif %} -->
						
						
							<!-- <li class="prev disabled"><a>&larr; Previous</a></li> -->
						

							<li><a href="/archive">Archive</a></li>

						
							<li class="next"><a class="internal" rel="next"  href="/2013/new-born.html" title="你的第一篇博客">Next &rarr;</a></li>
						
						
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->

				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<h4>about</h4>
					<ul>
						<li class="contact"><address><span class="author fn n">zly</span> - <span class="fn email">zengluyang#gmail.com</span></address></li>
						<li class="github"><a href="http://github.com/zengluyang/" rel="me">github.com/zengluyang</a></li>
					</ul>
				</div><!-- misc -->

			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	// load('https://apis.google.com/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
	// load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/2013/learning-ns-3-1.html" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>
  
    
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>

    
<script type="text/javascript">

  var _gaq = _gaq || [];
  var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-44225099-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
